<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Usuarios - Lista</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
          <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body class="bg-light">

<div class="container mt-4">

    <h1 class="mb-4 text-center">Lista de Usuarios</h1>

    <!-- FORMULARIO DE FILTRO MULTICRITERIO -->
    <form class="row g-2 mb-3" method="get" action="/admin/usuarios/lista">

        <div class="col-md-2">
            <input type="number" class="form-control" name="idUsuario" placeholder="ID" th:value="${filtroId}">
        </div>

        <div class="col-md-3">
            <input type="text" class="form-control" name="nombre" placeholder="Nombre" th:value="${filtroNombre}">
        </div>

        <div class="col-md-3">
            <select class="form-control" name="idRol">
                <option value="">Todos los roles</option>
                <option th:each="r : ${roles}" th:value="${r.idRol}" 
                        th:text="${r.rol}" th:selected="${r.idRol} == ${filtroRol}">
                </option>
            </select>
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Filtrar</button>
        </div>

        <div class="col-md-2">
            <a class="btn btn-secondary w-100" th:href="@{/admin/usuarios/lista}">Limpiar</a>
        </div>

    </form>

    <div class="mb-3 text-end">
        <a class="btn btn-primary" th:href="@{/admin/usuarios/crear}">
            + Crear Usuario
        </a>

        <!-- Bot√≥n Exportar PDF -->
        <a class="btn btn-danger" 
           th:href="@{/admin/usuarios/exportar-pdf(
               idUsuario=${filtroId},
               nombre=${filtroNombre},
               idRol=${filtroRol}
           )}">
           üìÑ Exportar PDF
        </a>
    </div>

    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Acciones</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="u : ${usuarios}">
            <td th:text="${u.idUsuario}"></td>
            <td th:text="${u.nombre + ' ' + u.apellido}"></td>
            <td th:text="${u.email}"></td>
            <td th:text="${u.rol != null ? u.rol.rol : '‚Äî'}"></td>

            <td>
                <a class="btn btn-sm btn-info"
                   th:href="@{'/admin/usuarios/editar/' + ${u.idUsuario}}">
                    Ver
                </a>

                <a class="btn btn-sm btn-warning"
                   th:href="@{'/admin/usuarios/editar/' + ${u.idUsuario}}">
                    Editar
                </a>

                <a class="btn btn-sm btn-danger"
                   th:href="@{'/admin/usuarios/eliminar/' + ${u.idUsuario}}"
                   onclick="return confirm('¬øEliminar este usuario?')">
                    Eliminar
                </a>
            </td>
        </tr>
        </tbody>

    </table>

    <div class="mt-4">
        <a class="btn btn-secondary" th:href="@{/admin/dashboard}">‚Üê Volver al panel</a>
    </div>

</div>
</body>
</html>
